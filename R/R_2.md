# R语言的数据对象(一)：向量与矩阵

---

## 基本介绍

在R语言中，所有的变量、数据、函数、结果、字符串都以对象（objects）的形式存在，我们可以通过一些运算符（如运算、逻辑、比较等）和一些函数来对这些对象进行操作。在R运行的过程中，对象通过其名称被创建和储存。

### 数据类型

- R语言基本的数据类型主要有数值型、字符型、逻辑型。
1. 数值型
   
   - 整型：12
   
   - 浮点数：12.1314
   
   > R支持复数类型，复数写法写成`3.5-4.2i`。

2. 字符型：用" "或' '进行包裹的文本
   
   - "Hello, world!"
   
   - "1234"
   
   > R语言没有“字符”类型，只有“字符串”类型

3. 逻辑型
   
   - TRUE
   
   - FALSE

### 数据结构

- R语言数据结构包括向量，矩阵和数据框，多维数组，列表，对象等。数据中元素、行、列可以通过名字访问。最基本的数据类型是向量，其它数据类型的访问也是基于向量进行的。

### 常量与变量

- 常量：
  
  直接写在程序中的值，包括数值、字符串等。逻辑常量为`TRUE`和`FALSE`，R中有一些名称指向特定的常量：
  
  ```
  pi = 3.141593
  letters #26个小写字母对应的向量
  LETTERS #26个写字母对应的向量
  month.name #12个月份对应的向量（全称）
  month.abb #12个月份对应的向量（三个字母缩写）
  ```

- 变量
  
  用于保存输入的值或者计算得到的值，在R中，变量可以是所有数据类型（包括标量、向量、矩阵、数据框、函数等）。
  
  R的变量没有固定的类型。R是“动态类型”语言，赋值实际上是绑定，即把一个变量名与一个存储地址联系在一起，同一个存储地址可以对应多个变量名。

- 变量的赋值
  
  变量可以通过`<-`进行赋值（快捷键`[alt]+-`）；也可以通过`=`进行赋值，但一般不推荐，`=`一般用于函数中对参数取值。
  
  ```
  a <- 1.2
  b = 3
  ```

- 变量类型的判断
  
  `is.numeric(x)`：判断x是否是数值型
  
  `is.character(x)`：判断x是否是字符型
  
  `is.logical(x)`：判断x是否是逻辑型

- 数据类型的转换
  
  `as.numeric(x)`：把x转换为数值型
  
  ```
  > as.numeric(562.6523589)
  [1] 562.6524
  > as.numeric("5642321556322")
  [1] 5.642322e+12
  > as.numeric(TRUE)
  [1] 1
  > as.numeric("Hello world")
  [1] NA #转换为数值型要求字符可以转换为数值
  Warning message:
  NAs introduced by coercion 
  ```
  
  `as.character(x)`：把x转换为字符型，其它两种数据类型可以转换为字符型。
  
  `as.logic(x)`：把x转换为逻辑型
  
  ```
  > as.logical("1")
  [1] NA #字符型不能转换为逻辑型
  > as.logical(1)
  [1] TRUE
  > as.logical(2)
  [1] TRUE
  > as.logical(0)
  [1] FALSE
  > as.logical(-5)
  [1] TRUE
  # 0转化为FALSE，非0数值均转化为TRUE
  ```

### 特殊值

- `NA`：（not available）数据缺失
  
  `is.na(x)`：判断是否为NA

- `NULL`：空值
  
  `is.null(x)`：判断是否为NULL

- `NaN`：（not a number）
  
  `is.nan(x)`：判断是否为NaN

- `Inf`：正无穷
  
  `-Inf`：负无穷
  
  `is.infinite(x)`：判断是否是无穷大

```
> 2/0
[1] Inf
> -2/0
[1] -Inf
> 0/0
[1] NaN
```

## 向量

### 向量的赋值及函数

1. `c(...)`：（combine）把对象组合成一个向量
   
   - 一个向量中的所有元素都是同一种数据类型，否则会被进行强制转换。
   
   ```
   v1 <- c(5,33,2.5)
   v2 <- c("a", "b", "Hi")
   v3 <- c(v1, v2)
   v4 <- c(v1, TRUE)
   v5 <- c(TRUE,TRUE,FALSE)
   ```

2. `rep(x...)`：生成含重复对象的向量
   
   默认：`rep(x, times = 1, length.out = NA, each = 1)`
   
   - `x`：需要为向量
   
   - `times`：x重复次数
   
   - `length.out`：输出向量的元素个数（会自动补足长度）
   
   - `each`：x向量中每个元素重复的次数
   
   ```
   v6 <- rep(v1, times = 2)  #相当于v6 <- rep(v1, 2)
   v7 <- rep(v1, each = 3)  #相当于v7 <- rep(v1, 1, NA, 3)
   v8 <- rep(v1, times = 2, each = 3)
   #先执行each，在执行times
   ```

3. `seq(...)`：生成等差序列的向量
   
   默认：`seq(from = 1, to = 1, by = ((to - from)/(length.out - 1)), length.out = NULL, along.with = NULL, ...)`
   
   - `from`：起始值
   
   - `to`：最大结尾值（即向量中最大的元素值小于等于`to`)
   
   - `by`：步幅（increment）；为正数时为递增数列，为负数时为递减数列。
   
   - `length.out`：输出向量的元素个数
   
   ```
   v9 <- seq(from = 2, to = 10)
   v10 <- seq(from = 2, to = 10, by = 3)
   v11 <- seq(from = 2, by = 4, length.out = 10)
   v12 <- 1:8 #相当于seq(from = 1, to = 8, by = 1)
   ```

### 元素的索引

1. 位置索引
   
   提取单个元素：`x[n]`。
   
   提取多个元素：`x[c(n1,n2,...)]`；或可以使用`x[n1:n2]`提取第n1个至第n2个元素（包含第n1个和第n2个）
   
   提取除了指定元素外的其它元素：`x[-n]`或`x[-c(n1,n2,...)]`
   
   - 在R中，向量元素序号从1开始计数。
   
   ```
   > v1[3]
   [1] 2.5
   
   > v10[c(1,2,5)]#提取多个元素
   [1]  2  5 NA
   #由于v10只有3个元素，所以提取第5个元素超出向量长度，返回NA
   > v1[-1]
   [1] 33.0  2.5
   > v1
   [1]  5.0 33.0  2.5
   > v10
   [1] 2 5 8
   ```

2. 名称索引
   
   如果被索引的对象有名称属性，就可以采用待提取元素的名称作为索引值。
   
   ```
   > v1
    a  b  c  d  e 
   -1  0 12  5  6 
   > v1['a'] #名称索引单个元素
    a 
   -1 
   > v1[a] #元素名称必须用‘’进行包裹
   Error: object 'a' not found
   > v1[c('a','c')] #名称索引多个元素
    a  c 
   -1 12 
   ```

3. 条件索引
   
   返回判断为TRUE的值
   
   ```
   > v1>0
       a     b     c     d     e 
   FALSE FALSE  TRUE  TRUE  TRUE 
   > v1[v1>0]
    c  d  e 
   12  5  6 
   > v1[c(F,F,T,T,T)]
    c  d  e 
   12  5  6 
   ```

### 向量的操作

1. `length(x)`：长度函数，会给出向量的长度，也可以重新设置向量的长度。
   
   ```
   length(seq(from = 2, to  = 10))
   length(v9)
   # 查询向量的长度
   
   length(v2) <- 8
   ```

2. `sort(x)`：排序函数，会按升序或者降序排列向量内的元素
   
   默认：`sort(x, decreasing = FALSE, na.last = NA, ...)`
   
   - `x`：向量名称
   
   - `decreasing`：选择按升序或降序排序，输入逻辑值（TRUE或FALSE）
   
   - `na.last`：对NA值的处理。TRUE为NA值不删除，排在向量的最末端；FALSE为NA值不删除，排在向量的最前端；NA为删除所有NA值
   
   ```
   #数字向量按大小排序
   > sort(c(5,12,1,-50))
   [1] -50   1   5  1
   #字符向量按一定顺序排序
   > sort(c(6,11,"bc","Aa","ba"))
   [1] "11" "6"  "Aa" "ba" "bc"
   > sort(c("a","A","b","C","Ac","cA","c"))
   [1] "a"  "A"  "Ac" "b"  "c"  "C"  "cA"
   ```
   
   - `sort`函数不修改原向量而是会生成一个新向量

3. `names(x)`：命名函数
   
   为向量中的元素赋予名称
   
   ```
    v1 <- c(-1,0,12,5,6)
   > n1 <- c('a','b','c','d','e'
   > names(v1) <- n1 #n1向量中的元素作为v1向量中元素的名称
   
   > n1
   [1] "a" "b" "c" "d" "e"
   > names(v1) #查看v1中元素的名称
   [1] "a" "b" "c" "d" "e"
   > v1 #查看v1，上面一行是名称，下面一行是元素的值
    a  b  c  d  e 
   -1  0 12  5  6 
    > names(n1) #查看n1中元素的名称，由于没有命名所以返回NULL
   NULL
   ```
   
   > 在R软件中，面向向量的操作是R语言的一个关键特征，这可以使得处理多个元素时速度快且效率高，这比迭代运行（如循环效率更高）。

4. `sum(x)`：求和函数

5. `prod(x)`：连乘函数

6. 向量的运算
   
   ```
   > v1 <- c(5.5,5,3,-1,0)
   > v2 <- c(-1,1,2,0,0)
   > v1 * v2
   [1] -5.5  5.0  6.0  0.0  0.0
   > v1+v2
   [1]  4.5  6.0  5.0 -1.0  0.0
   > v1+3
   [1] 8.5 8.0 6.0 2.0 3.0
   > v1-2<0
   [1] FALSE FALSE FALSE  TURE TURE
   > sum(v1)
   [1] 12.5
   > sum(v2)
   [1] 2
   > prod(v1)
   [1] 0
   ```

## 矩阵

### 矩阵的赋值

1. `matirx()`：生成一个矩阵
   
   - 默认：`matrix(data = NA, nrow = 1, ncol = 1, byrow = FALSE, dimnames = NULL)`
     
     `data`：一个向量
     
     `nrow`：定义行数
     
     `ncol`：定义列数
     
     `byrow`：是否按行进行排列，默认按列排列
     
     `dimnames`：定义行名称及列名称
   
   - 例子
   
   ```
   > v1 <- c(5.5,5,3,-1,0)
   > m1 = matrix(data = c(v1,2),nrow = 3)
   > m1
        [,1] [,2]
   [1,]  5.5   -1
   [2,]  5.0    0
   [3,]  3.0    2
   # 定义一个矩阵，nrow与ncol可以只确定一个，其余的自动计算
   
   > m2 = matrix(data = NA, nrow = 3, ncol = 4)
   > m2
        [,1] [,2] [,3] [,4]
   [1,]   NA   NA   NA   NA
   [2,]   NA   NA   NA   NA
   [3,]   NA   NA   NA   NA 
   # 定义一个空矩阵。一般用于存储数据，即先设计一个特定结构的矩阵作为数据容器，之后再向其中填充数据
   
   > matrix(data=v1,nrow=3)
        [,1] [,2]
   [1,]  5.5 -1.0
   [2,]  5.0  0.0
   [3,]  3.0  5.5
   Warning message:
   In matrix(data = v1, nrow = 3) :
     data length [5] is not a sub-multiple or multiple of the number of rows [3]
   # 当提供的向量v1的元素个数与行列设置不匹配时（或不是整数倍时）会出现提示信息
   # 当矩阵元素个数>向量元素个数，会进行重复填充
   
   > m3 = matrix(data = c(v1,3), nrow = 3, byrow = TRUE)
   > m3
        [,1] [,2]
   [1,]  5.5    5
   [2,]  3.0   -1
   [3,]  0.0    3
   # byrow用于设置元素按行排列或按列排列
   ```

2. `rbind`，`cbind`：把长度相等的向量合并为矩阵
   
   `rbind`：把向量作为行，合并为矩阵
   
   `cbind`：把向量作为列合并为矩阵
   
   ```
   > v1 = 1:5
   > v2 = 11:15
   > rbind(v1,v2)
      [,1] [,2] [,3] [,4] [,5]
   v1    1    2    3    4    5
   v2   11   12   13   14   15
   > cbind(v2,v1)
        v2 v1
   [1,] 11  1
   [2,] 12  2
   [3,] 13  3
   [4,] 14  4
   [5,] 15  5
   ```

3. 矩阵行列命名

4. `diag`：生成对角线矩阵（单位矩阵）；也可以提取矩阵的对角线元素（见**矩阵元素的索引**）
   
   - 默认：`diag(x = 1, nrow, ncol, names = TRUE)`
     
     `x`：对角线元素的数值
     
     `nrow`：生成nrow*nrow的单位矩阵的行数
     
     `ncol`：生成nrow*ncol的矩阵的列数，必须要有nrow设置，不能只设置ncol
   
   ```
   > diag(nrow = 3)
        [,1] [,2] [,3]
   [1,]    1    0    0
   [2,]    0    1    0
   [3,]    0    0    1 
   > diag(x = 3, nrow = 4)
        [,1] [,2] [,3] [,4]
   [1,]    3    0    0    0
   [2,]    0    3    0    0
   [3,]    0    0    3    0
   [4,]    0    0    0    3 
   > diag(nrow = 2, ncol = 5)
        [,1] [,2] [,3] [,4] [,5]
   [1,]    1    0    0    0    0
   [2,]    0    1    0    0    0
   ```

### 矩阵元素的索引

1. 位置索引：
   
   - 提取单个元素：`M[n1,n2]`
   
   - 提取某行：`M[n1, ]`；提取某列：`M[ ,n2]`；返回一个向量
   
   - 提取子矩阵：`M[-v1,-v2]`，提取除了v1行和v2列外的元素组成新矩阵
   
   ```
   > A <- matrix(data = 1:25, nrow = 5)
   > A
        [,1] [,2] [,3] [,4] [,5]
   [1,]    1    6   11   16   21
   [2,]    2    7   12   17   22
   [3,]    3    8   13   18   23
   [4,]    4    9   14   19   24
   [5,]    5   10   15   20   25
   > A[4,2] #A[n1,n2]取出第n1行和第n2列的元素
   [1] 9
   > A[ ,2] #A[ ,n2]取出第n2列的所有元素
   [1]  6  7  8  9 10
   > A[3, ] #A[n1, ]取出第n1行的所有元素
   [1]  3  8 13 18 23
   > A[-1,3]
   [1] 12 13 14 15 #返回一个向量
   > A[-c(1,2), -c(2,3)]
   
        [,1] [,2] [,3]
   
   [1,]    3   18   23
   [2,]    4   19   24
   [3,]    5   20   25
   ```

2. `diag(x = A)`：提取对角线元素
- `x`：矩阵名称
  
  ```
  > B
  >         [,1] [,2] [,3] [,4] [,5]
  >    [1,]    1    3    5    7    9
  >    [2,]    2    4    6    8   10
  > diag(A)
  >    [1]  1  7 13 19 25
  > diag(B)
  >    [1] 1 4
  ```
3. 矩阵元素的替换
   
   ```
   > Bcopy
   >         [,1]  [,2] [,3]
   >    [1,]  0.3  91.0 -4.2
   >    [2,]  4.5   0.1  8.2
   >    [3,] 55.3 105.5  2.9
   
    # 替换整行/整列元素
   
    > Bcopy[1, ] <- 3
    > Bcopy
    >         [,1]  [,2] [,3]
    >    [1,]  3.0   3.0  3.0
    >    [2,]  4.5   0.1  8.2
    >    [3,] 55.3 105.5  2.9
   
    #替换个别元素，注意替换的顺序(1,3)->(2,3)->(1,1)->(2,1)
   
    > Bcopy[c(1,2),c(3,1)] <- c(-1,-2,-3,-4)
    > Bcopy
    >         [,1]  [,2] [,3]
    >    [1,] -3.0   3.0 -1.0
    >    [2,] -4.0   0.1 -2.0
    >    [3,] 55.3 105.5  2.9
   ```

### 矩阵的运算

1. `t(M)`：矩阵的转置

2. 矩阵的数乘
   
    使用标准的运算符号`*`，即可使矩阵里所有元素乘以一个任意数值
   
   ```
   > A <- cbind(c(2,5,2),c(6,1,4))
   > a <- 2
   > a*A
   >         [,1] [,2]
   >    [1,]    4   12
   >    [2,]   10    2
   >    [3,]    4    8
   ```

3. 矩阵的加减
   
    使用`+`，`-`即可对同阶矩阵进行加法和减法运算，如果非同阶矩阵则不能进行运算，会导致报错
   
   ```
   > A <- cbind(c(2,5,2),c(6,1,4))
   > B <- cbind(c(2,8,4),c(8,0,3))
   > A+B
   >         [,1] [,2]
   >    [1,]    4   14
   >    [2,]   13    1
   >    [3,]    6    7
   
   # 如果非同阶矩阵会导致报错
   
   > A-C
   >    Error in A - C : non-conformable arrays
   ```

4. 矩阵的乘法
   
    使用`%*%`对两个矩阵进行相乘。矩阵相乘时，矩阵的位置不可交换，且需要确保第一个矩阵的列数等于第二个矩阵的行数。
   
   ```
   > ncol(A)==nrow(C)
   >    [1] TRUE
   > A%*%C
   >         [,1] [,2]
   >    [1,]   34   30
   >    [2,]   29    5
   >    [3,]   26   20
   ```

5. 逆矩阵
   
    R中提供了求逆矩阵的函数`solve()`。具有可逆性的矩阵必须是正方形矩阵。
   
   ```
   > solve(A)
   >    Error in solve.default(A) : 'a' (3 x 2) must be square
   
   # 不是正方形不能求逆矩阵
   
   > solve(C)
   >          [,1] [,2]
   >    [1,]  0.20  0.0
   >    [2,] -0.16  0.2 
   > C%*%solve(C)
   >         [,1] [,2]
   >    [1,]    1    0
   >    [2,]    0    1 
   
   # 验证该矩阵是可逆矩阵
   ```
